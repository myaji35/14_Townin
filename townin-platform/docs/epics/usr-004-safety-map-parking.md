# Epic: USR-004 - Safety Map (Parking)

## Epic Overview

| Field | Value |
|-------|-------|
| **Epic ID** | USR-004 |
| **Epic Title** | Safety Map (Parking) |
| **Priority** | P0 (Critical) |
| **Status** | ğŸ“‹ PLANNED |
| **Estimated Effort** | 5 days |
| **Actual Effort** | - |
| **Start Date** | TBD |
| **End Date** | TBD |
| **Phase** | Phase 1 - Traffic Acquisition (User App) |
| **Category** | USR - User App |
| **Owner** | Mobile Team (Flutter) |

## Business Value

### Problem Statement
ë„ì‹¬ ì£¼ì°¨ë‚œì€ ì¼ìƒì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ì…ë‹ˆë‹¤. íƒ€ìš´ì¸ì€ ì„œìš¸ì‹œ ê³µì˜ ì£¼ì°¨ì¥ ì •ë³´ì™€ ì‹¤ì‹œê°„ ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ë¥¼ ì œê³µí•˜ì—¬ ì£¼ì°¨ ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚¤ê³ , ì´ë¥¼ í†µí•´ **Traffic Anchor**ë¡œ í™œìš©í•©ë‹ˆë‹¤.

### Business Value
- **Traffic Anchor**: ì£¼ì°¨ë§µìœ¼ë¡œ ê²€ìƒ‰ ìœ ì…, ì¼ìƒì  ì‚¬ìš© ìœ ë„
- **ì‹œê°„ ì ˆì•½**: ì£¼ì°¨ ê³µê°„ ì°¾ëŠ” ì‹œê°„ í‰ê·  10ë¶„ ë‹¨ì¶•
- **ì‚¬ìš©ì ë§Œì¡±ë„**: ì‹¤ì‹œê°„ ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ë¡œ ì •í™•í•œ ì •ë³´ ì œê³µ
- **ê´‘ê³  ê¸°íšŒ**: ì£¼ì°¨ì¥ ì¸ê·¼ ìƒì  ê´‘ê³  (Phase 2)

### Target Users
- **ìš´ì „ì**: ì£¼ì°¨ ê³µê°„ ì°¾ê¸°
- **ìƒê¶Œ ë°©ë¬¸ì**: ëª©ì ì§€ ì¸ê·¼ ì£¼ì°¨ì¥ ê²€ìƒ‰
- **ì´ë²¤íŠ¸ ì°¸ì„ì**: ê³µì—°ì¥, ê²½ê¸°ì¥ ì¸ê·¼ ì£¼ì°¨ì¥

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| ì£¼ì°¨ë§µ ì‚¬ìš©ë¥  | â‰¥ 40% | ì‚¬ìš©ì ì¤‘ ì£¼ì°¨ë§µ ì§„ì… ë¹„ìœ¨ |
| ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ì •í™•ë„ | â‰¥ 90% | ì‹¤ì‹œê°„ ë°ì´í„° vs ì‹¤ì œ ë¹„êµ |
| ì§€ë„ ë¡œë”© ì‹œê°„ | < 2ì´ˆ | ì£¼ì°¨ì¥ ë§ˆì»¤ ë¡œë“œ í‰ê·  ì‹œê°„ |
| ì¬ë°©ë¬¸ìœ¨ | â‰¥ 50% | ì›” 2íšŒ ì´ìƒ ì£¼ì°¨ë§µ ì¬ë°©ë¬¸ |
| ê²½ë¡œ ì•ˆë‚´ ì‚¬ìš©ë¥  | â‰¥ 30% | ì£¼ì°¨ë§µ ì‚¬ìš©ì ì¤‘ ê²½ë¡œ ì•ˆë‚´ ì‚¬ìš© |

## Epic Scope

### In Scope
âœ… **ì£¼ì°¨ì¥ ì§€ë„ ë·°ì–´**
- ì§€ë„ ìœ„ ì£¼ì°¨ì¥ ë§ˆì»¤ í‘œì‹œ
- ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ì‹¤ì‹œê°„ í‘œì‹œ
- ì£¼ì°¨ì¥ ìš´ì˜ ì‹œê°„, ìš”ê¸ˆ ì •ë³´
- í˜„ì¬ ìœ„ì¹˜ì—ì„œ ê±°ë¦¬ í‘œì‹œ

âœ… **ì£¼ì°¨ì¥ ê²€ìƒ‰ ë° í•„í„°**
- ì£¼ì†Œ ê²€ìƒ‰
- ë°˜ê²½ ê²€ìƒ‰ (500m, 1km, 2km)
- ì£¼ì°¨ ê°€ëŠ¥ ì—¬ë¶€ í•„í„° (ë¹ˆ ì£¼ì°¨ì¥ë§Œ)
- ë¬´ë£Œ ì£¼ì°¨ì¥ í•„í„°
- ê±°ë¦¬ìˆœ ì •ë ¬

âœ… **ì£¼ì°¨ì¥ ìƒì„¸ ì •ë³´**
- ì£¼ì°¨ì¥ëª…, ì£¼ì†Œ
- ì´ ì£¼ì°¨ ë©´ìˆ˜, í˜„ì¬ ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜
- ìš´ì˜ ì‹œê°„
- ìš”ê¸ˆ ì •ë³´ (ê¸°ë³¸ ìš”ê¸ˆ, ì¶”ê°€ ìš”ê¸ˆ)
- ì „í™”ë²ˆí˜¸
- ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„

âœ… **ì£¼ì°¨ì¥ ê²½ë¡œ ì•ˆë‚´**
- í˜„ì¬ ìœ„ì¹˜ â†’ ì£¼ì°¨ì¥ ê²½ë¡œ
- ë„ë³´/ì°¨ëŸ‰ ê²½ë¡œ
- ì˜ˆìƒ ì†Œìš” ì‹œê°„
- ì¹´ì¹´ì˜¤ë§µ/ë„¤ì´ë²„ë§µ ì™¸ë¶€ ì•± ì—°ë™

âœ… **ì£¼ì°¨ì¥ ì¦ê²¨ì°¾ê¸°**
- ìì£¼ ê°€ëŠ” ì£¼ì°¨ì¥ ì¦ê²¨ì°¾ê¸°
- ì¦ê²¨ì°¾ê¸° ëª©ë¡
- ì¦ê²¨ì°¾ê¸° ì£¼ì°¨ì¥ ì•Œë¦¼ (ì£¼ì°¨ ê°€ëŠ¥ ì‹œ)

### Out of Scope
âŒ ë¯¼ê°„ ì£¼ì°¨ì¥ ì •ë³´ - Phase 2
âŒ ì£¼ì°¨ì¥ ì˜ˆì•½ - Phase 3
âŒ ì£¼ì°¨ ìš”ê¸ˆ ê²°ì œ - Phase 3
âŒ ì£¼ì°¨ì¥ ë¦¬ë·°/í‰ì  - Phase 2

## User Stories

### Story 4.1: ì£¼ì°¨ì¥ ì§€ë„ ê¸°ë³¸ í™”ë©´
**As a** ìš´ì „ì
**I want to** ë‚´ ì£¼ë³€ ì£¼ì°¨ì¥ì„ ì§€ë„ì—ì„œ ë³´ê³ 
**So that** ë¹ ë¥´ê²Œ ì£¼ì°¨ ê³µê°„ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] í˜„ì¬ ìœ„ì¹˜ ì¤‘ì‹¬ ì§€ë„
- [ ] ë°˜ê²½ 1km ë‚´ ì£¼ì°¨ì¥ ë§ˆì»¤ í‘œì‹œ
- [ ] ì£¼ì°¨ì¥ ë§ˆì»¤ ìƒ‰ìƒ: ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ì— ë”°ë¼
  - ë¹¨ê°„ìƒ‰: ë§Œì°¨ (0ëŒ€)
  - ë…¸ë€ìƒ‰: ì—¬ìœ  ìˆìŒ (1-10ëŒ€)
  - ë…¹ìƒ‰: ë§ìŒ (11ëŒ€ ì´ìƒ)
- [ ] ë§ˆì»¤ì— ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ìˆ«ì í‘œì‹œ
- [ ] í•˜ë‹¨: ì£¼ì°¨ì¥ ê°œìˆ˜ í‘œì‹œ (ì˜ˆ: "ì£¼ë³€ ì£¼ì°¨ì¥ 15ê°œ")

**Tasks:**
- [ ] ParkingMapScreen ìœ„ì ¯ ì‘ì„±
- [ ] GET /api/public-data/parking?lat=...&lng=...&radius=1000
- [ ] ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ì— ë”°ë¥¸ ë§ˆì»¤ ìƒ‰ìƒ ë¡œì§
- [ ] ì§€ë„ ë§ˆì»¤ ë Œë”ë§

**Story Points:** 5

---

### Story 4.2: ì£¼ì°¨ì¥ ìƒì„¸ ì •ë³´ BottomSheet
**As a** ìš´ì „ì
**I want to** ì£¼ì°¨ì¥ ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³´ê³ 
**So that** ì£¼ì°¨ ê°€ëŠ¥ ì—¬ë¶€ì™€ ìš”ê¸ˆì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë§ˆì»¤ í´ë¦­ ì‹œ BottomSheet í‘œì‹œ
- [ ] ì£¼ì°¨ì¥ ì •ë³´:
  - ì£¼ì°¨ì¥ëª…
  - ì£¼ì†Œ
  - ì´ ì£¼ì°¨ ë©´ìˆ˜ / í˜„ì¬ ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ (ê°•ì¡°)
  - ìš´ì˜ ì‹œê°„ (ì˜ˆ: "24ì‹œê°„" ë˜ëŠ” "09:00-18:00")
  - ìš”ê¸ˆ ì •ë³´ (ì˜ˆ: "10ë¶„ë‹¹ 500ì›")
  - ì „í™”ë²ˆí˜¸
  - í˜„ì¬ ìœ„ì¹˜ë¡œë¶€í„° ê±°ë¦¬
  - ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ (ì˜ˆ: "5ë¶„ ì „ ì—…ë°ì´íŠ¸")
- [ ] "ê¸¸ì°¾ê¸°" ë²„íŠ¼
- [ ] "ì¦ê²¨ì°¾ê¸° ì¶”ê°€" ë²„íŠ¼

**Tasks:**
- [ ] ParkingDetailBottomSheet ìœ„ì ¯ ì‘ì„±
- [ ] ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ê°•ì¡° UI (í° ê¸€ì”¨, ìƒ‰ìƒ)
- [ ] ê±°ë¦¬ ê³„ì‚° ë¡œì§

**Story Points:** 3

---

### Story 4.3: ì£¼ì°¨ ê°€ëŠ¥ ì—¬ë¶€ í•„í„°
**As a** ìš´ì „ì
**I want to** ì£¼ì°¨ ê°€ëŠ¥í•œ ì£¼ì°¨ì¥ë§Œ ë³´ê³ 
**So that** ë§Œì°¨ì¸ ì£¼ì°¨ì¥ì€ ì œì™¸í•˜ê³  ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "ë¹ˆ ì£¼ì°¨ì¥ë§Œ" í† ê¸€ ìŠ¤ìœ„ì¹˜
- [ ] í† ê¸€ ON: ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ > 0ì¸ ì£¼ì°¨ì¥ë§Œ í‘œì‹œ
- [ ] í† ê¸€ OFF: ëª¨ë“  ì£¼ì°¨ì¥ í‘œì‹œ
- [ ] í•„í„°ë§ëœ ì£¼ì°¨ì¥ ê°œìˆ˜ ì—…ë°ì´íŠ¸

**Tasks:**
- [ ] í•„í„° í† ê¸€ UI
- [ ] í•„í„°ë§ ë¡œì§ (availableSpaces > 0)
- [ ] ì§€ë„ ë§ˆì»¤ ì—…ë°ì´íŠ¸

**Story Points:** 2

---

### Story 4.4: ë¬´ë£Œ ì£¼ì°¨ì¥ í•„í„°
**As a** ìš´ì „ì
**I want to** ë¬´ë£Œ ì£¼ì°¨ì¥ë§Œ ë³´ê³ 
**So that** ì£¼ì°¨ ìš”ê¸ˆì„ ì ˆì•½í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "ë¬´ë£Œ ì£¼ì°¨ì¥" ì²´í¬ë°•ìŠ¤
- [ ] ì²´í¬ ì‹œ ë¬´ë£Œ ì£¼ì°¨ì¥ë§Œ í‘œì‹œ
- [ ] ë¬´ë£Œ ì£¼ì°¨ì¥ ë§ˆì»¤ ë³„ë„ ì•„ì´ì½˜ (ì˜ˆ: ë³„í‘œ)

**Tasks:**
- [ ] ë¬´ë£Œ ì£¼ì°¨ì¥ í•„í„° UI
- [ ] ìš”ê¸ˆ ì •ë³´ íŒŒì‹± (feeInfo í•„ë“œ)
- [ ] ë¬´ë£Œ ì£¼ì°¨ì¥ íŒë³„ ë¡œì§

**Story Points:** 2

---

### Story 4.5: ê±°ë¦¬ìˆœ ì •ë ¬ ë¦¬ìŠ¤íŠ¸ ë·°
**As a** ìš´ì „ì
**I want to** ì£¼ì°¨ì¥ì„ ê±°ë¦¬ìˆœìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¡œ ë³´ê³ 
**So that** ê°€ì¥ ê°€ê¹Œìš´ ì£¼ì°¨ì¥ì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] í•˜ë‹¨ BottomSheet: ì£¼ì°¨ì¥ ë¦¬ìŠ¤íŠ¸
- [ ] ê±°ë¦¬ìˆœ ì •ë ¬ (ê°€ê¹Œìš´ ìˆœ)
- [ ] ê° í•­ëª©: ì£¼ì°¨ì¥ëª…, ê±°ë¦¬, ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜, ìš”ê¸ˆ
- [ ] í•­ëª© í´ë¦­ ì‹œ ì§€ë„ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
- [ ] ì§€ë„/ë¦¬ìŠ¤íŠ¸ ì „í™˜ ë²„íŠ¼

**Tasks:**
- [ ] ParkingListBottomSheet ìœ„ì ¯ ì‘ì„±
- [ ] ê±°ë¦¬ ê³„ì‚° ë° ì •ë ¬
- [ ] ë¦¬ìŠ¤íŠ¸ í•­ëª© UI
- [ ] ì§€ë„/ë¦¬ìŠ¤íŠ¸ ì „í™˜ í† ê¸€

**Story Points:** 5

---

### Story 4.6: ì£¼ì°¨ì¥ ê²½ë¡œ ì•ˆë‚´
**As a** ìš´ì „ì
**I want to** ì£¼ì°¨ì¥ê¹Œì§€ ê²½ë¡œë¥¼ ì•ˆë‚´ë°›ê³ 
**So that** ê¸¸ì„ ìƒì§€ ì•Šê³  ë„ì°©í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "ê¸¸ì°¾ê¸°" ë²„íŠ¼ í´ë¦­
- [ ] ê²½ë¡œ ì•ˆë‚´ ì˜µì…˜:
  - ì¹´ì¹´ì˜¤ë§µ ì•±ìœ¼ë¡œ ì—´ê¸°
  - ë„¤ì´ë²„ë§µ ì•±ìœ¼ë¡œ ì—´ê¸°
  - ì•± ë‚´ ê²½ë¡œ í‘œì‹œ (Polyline)
- [ ] ì°¨ëŸ‰ ê²½ë¡œ (ê¸°ë³¸)
- [ ] ì˜ˆìƒ ì†Œìš” ì‹œê°„ í‘œì‹œ

**Tasks:**
- [ ] url_launcher íŒ¨í‚¤ì§€ ì‚¬ìš©
- [ ] ì¹´ì¹´ì˜¤ë§µ URL ìŠ¤í‚´ (kakaomap://route)
- [ ] ë„¤ì´ë²„ë§µ URL ìŠ¤í‚´ (nmap://route)
- [ ] ì•± ë‚´ ê²½ë¡œ í‘œì‹œ (Kakao Mobility API)

**Story Points:** 5

---

### Story 4.7: ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
**As a** ìš´ì „ì
**I want to** ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ê³ 
**So that** ìµœì‹  ì •ë³´ë¡œ ì£¼ì°¨ì¥ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] 30ë¶„ë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
- [ ] ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼
- [ ] ì—…ë°ì´íŠ¸ ì‹œ ë§ˆì»¤ ìƒ‰ìƒ/ìˆ«ì ë³€ê²½
- [ ] ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ
- [ ] ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ (ì˜ˆ: "5ë¶„ ì „")

**Tasks:**
- [ ] Timerë¥¼ ì‚¬ìš©í•œ ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ (30ë¶„)
- [ ] ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ UI
- [ ] ì—…ë°ì´íŠ¸ ì‹œ ì• ë‹ˆë©”ì´ì…˜ (ë§ˆì»¤ ë³€í™”)

**Story Points:** 3

---

### Story 4.8: ì£¼ì°¨ì¥ ì¦ê²¨ì°¾ê¸°
**As a** ìš´ì „ì
**I want to** ìì£¼ ê°€ëŠ” ì£¼ì°¨ì¥ì„ ì¦ê²¨ì°¾ê¸°í•˜ê³ 
**So that** ë¹ ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "ì¦ê²¨ì°¾ê¸° ì¶”ê°€" ë²„íŠ¼ (ë³„ ì•„ì´ì½˜)
- [ ] ì¦ê²¨ì°¾ê¸° ëª©ë¡ (ì„¤ì • > ì¦ê²¨ì°¾ê¸°)
- [ ] ì¦ê²¨ì°¾ê¸° ì£¼ì°¨ì¥ ë§ˆì»¤ ë³„ë„ í‘œì‹œ (ë³„ ì•„ì´ì½˜)
- [ ] ìµœëŒ€ 10ê°œ ì¦ê²¨ì°¾ê¸°

**Tasks:**
- [ ] FavoriteParking ë¡œì»¬ ì €ì¥ (SharedPreferences)
- [ ] ì¦ê²¨ì°¾ê¸° CRUD
- [ ] ì¦ê²¨ì°¾ê¸° ëª©ë¡ UI

**Story Points:** 3

---

### Story 4.9: ì£¼ì°¨ì¥ ê²€ìƒ‰ (ì£¼ì†Œ/ì£¼ì°¨ì¥ëª…)
**As a** ìš´ì „ì
**I want to** ì£¼ì°¨ì¥ëª… ë˜ëŠ” ì£¼ì†Œë¡œ ê²€ìƒ‰í•˜ê³ 
**So that** íŠ¹ì • ì£¼ì°¨ì¥ì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìƒë‹¨ ê²€ìƒ‰ ë°”
- [ ] ì£¼ì°¨ì¥ëª… ë˜ëŠ” ì£¼ì†Œ ì…ë ¥
- [ ] ìë™ì™„ì„± (ì£¼ì°¨ì¥ëª… ë§¤ì¹­)
- [ ] ê²€ìƒ‰ ê²°ê³¼ ì„ íƒ ì‹œ í•´ë‹¹ ì£¼ì°¨ì¥ìœ¼ë¡œ ì´ë™

**Tasks:**
- [ ] ê²€ìƒ‰ ë°” UI
- [ ] ì£¼ì°¨ì¥ëª…/ì£¼ì†Œ í•„í„°ë§ ë¡œì§
- [ ] ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ UI

**Story Points:** 3

---

### Story 4.10: ì£¼ì°¨ ê°€ëŠ¥ ì•Œë¦¼ (Phase 1.5)
**As a** ìš´ì „ì
**I want to** ë§Œì°¨ì˜€ë˜ ì£¼ì°¨ì¥ì— ì£¼ì°¨ ê°€ëŠ¥ ì‹œ ì•Œë¦¼ë°›ê³ 
**So that** ì£¼ì°¨ ê³µê°„ì„ ë†“ì¹˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë§Œì°¨ ì£¼ì°¨ì¥ì— "ì•Œë¦¼ ì„¤ì •" ë²„íŠ¼
- [ ] ì£¼ì°¨ ê°€ëŠ¥ ì‹œ í‘¸ì‹œ ì•Œë¦¼
- [ ] ì•Œë¦¼ ìœ íš¨ ì‹œê°„ (1ì‹œê°„)
- [ ] ì•Œë¦¼ í›„ ìë™ í•´ì œ

**Tasks:**
- [ ] ì•Œë¦¼ ì„¤ì • ë²„íŠ¼ UI
- [ ] ì„œë²„ì— ì•Œë¦¼ ë“±ë¡ (POST /api/parking-alerts)
- [ ] ì£¼ì°¨ ê°€ëŠ¥ ì‹œ í‘¸ì‹œ ì•Œë¦¼ (ë°±ì—”ë“œ)

**Story Points:** 5

## Technical Specifications

### Technology Stack
- **Framework**: Flutter 3.x
- **Maps**: flutter_naver_map ë˜ëŠ” google_maps_flutter
- **URL Launcher**: url_launcher (ì¹´ì¹´ì˜¤ë§µ/ë„¤ì´ë²„ë§µ ì—°ë™)
- **Local Storage**: SharedPreferences (ì¦ê²¨ì°¾ê¸°)
- **State Management**: Riverpod

### Architecture Decisions

#### 1. ì‹¤ì‹œê°„ ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ì—…ë°ì´íŠ¸
**Decision**: 30ë¶„ ì£¼ê¸° í´ë§ + ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨

**Rationale**:
- **ì„œë²„ ë¶€í•˜**: WebSocketë³´ë‹¤ ë¶€í•˜ ë‚®ìŒ
- **ë°ì´í„° ìµœì‹ ì„±**: 30ë¶„ì´ë©´ ì¶©ë¶„íˆ ìœ ìš©
- **ì‚¬ìš©ì ì œì–´**: ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥

**êµ¬í˜„**:
```dart
Timer.periodic(Duration(minutes: 30), (timer) {
  _refreshParkingData();
});
```

#### 2. ì£¼ì°¨ì¥ ë§ˆì»¤ ìƒ‰ìƒ ì „ëµ
**Decision**: ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ê¸°ë°˜ 3ë‹¨ê³„ ìƒ‰ìƒ

**ìƒ‰ìƒ ë§¤í•‘**:
- ë¹¨ê°„ìƒ‰ (Red): 0ëŒ€ (ë§Œì°¨)
- ë…¸ë€ìƒ‰ (Yellow): 1-10ëŒ€ (ì—¬ìœ )
- ë…¹ìƒ‰ (Green): 11ëŒ€ ì´ìƒ (ë§ìŒ)

**Rationale**:
- **ì§ê´€ì **: ì‹ í˜¸ë“± ìƒ‰ìƒ ìœ ì‚¬
- **ë¹ ë¥¸ ì¸ì§€**: í•œëˆˆì— ì£¼ì°¨ ê°€ëŠ¥ ì—¬ë¶€ íŒŒì•…

### API Endpoints Used

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/public-data/parking?lat=...&lng=...&radius=1000` | ì£¼ì°¨ì¥ ì¡°íšŒ (ë°˜ê²½) |
| GET | `/api/public-data/parking?availableOnly=true` | ì£¼ì°¨ ê°€ëŠ¥í•œ ì£¼ì°¨ì¥ë§Œ |
| POST | `/api/parking-alerts` | ì£¼ì°¨ ê°€ëŠ¥ ì•Œë¦¼ ë“±ë¡ |

### State Management (Riverpod)
```dart
// parking_map_provider.dart
final parkingMapProvider = StateNotifierProvider<ParkingMapNotifier, ParkingMapState>((ref) {
  return ParkingMapNotifier(ref.read(apiServiceProvider));
});

class ParkingMapState {
  final List<Parking> parkings;
  final LatLng? currentLocation;
  final double radius;
  final bool availableOnly; // ë¹ˆ ì£¼ì°¨ì¥ë§Œ
  final bool freeOnly; // ë¬´ë£Œ ì£¼ì°¨ì¥ë§Œ
  final DateTime? lastUpdated;
  final bool isLoading;

  ParkingMapState({
    this.parkings = const [],
    this.currentLocation,
    this.radius = 1000,
    this.availableOnly = false,
    this.freeOnly = false,
    this.lastUpdated,
    this.isLoading = false,
  });
}

class ParkingMapNotifier extends StateNotifier<ParkingMapState> {
  ParkingMapNotifier(this._apiService) : super(ParkingMapState());

  final ApiService _apiService;
  Timer? _refreshTimer;

  Future<void> loadParkings(LatLng location, double radius) async {
    state = state.copyWith(isLoading: true);

    try {
      final parkings = await _apiService.getParkings(
        lat: location.latitude,
        lng: location.longitude,
        radius: radius,
        availableOnly: state.availableOnly,
      );

      state = state.copyWith(
        parkings: parkings,
        currentLocation: location,
        radius: radius,
        lastUpdated: DateTime.now(),
        isLoading: false,
      );
    } catch (e) {
      state = state.copyWith(isLoading: false);
      rethrow;
    }
  }

  void startAutoRefresh() {
    _refreshTimer?.cancel();
    _refreshTimer = Timer.periodic(Duration(minutes: 30), (_) {
      if (state.currentLocation != null) {
        loadParkings(state.currentLocation!, state.radius);
      }
    });
  }

  void toggleAvailableOnly() {
    state = state.copyWith(availableOnly: !state.availableOnly);
    if (state.currentLocation != null) {
      loadParkings(state.currentLocation!, state.radius);
    }
  }

  Color getMarkerColor(Parking parking) {
    if (parking.availableSpaces == 0) return Colors.red;
    if (parking.availableSpaces <= 10) return Colors.yellow;
    return Colors.green;
  }

  @override
  void dispose() {
    _refreshTimer?.cancel();
    super.dispose();
  }
}
```

### Screen Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† ì£¼ì°¨ë§µ         ğŸ” ì¦ê²¨ì°¾ê¸° â”‚ â† AppBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì£¼ì°¨ì¥ ê²€ìƒ‰]              â”‚ â† ê²€ìƒ‰ ë°”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚      ğŸ—ºï¸ ì§€ë„ ì˜ì—­            â”‚
â”‚   ğŸ…¿ï¸ ì£¼ì°¨ì¥ ë§ˆì»¤ (ìƒ‰ìƒ+ìˆ«ì) â”‚
â”‚   ğŸ“ í˜„ì¬ ìœ„ì¹˜              â”‚
â”‚                             â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ë¹ˆ ì£¼ì°¨ì¥ë§Œ] [ë¬´ë£Œë§Œ]       â”‚ â† í•„í„°
â”‚ [500m] [1km] [2km] [ìƒˆë¡œê³ ì¹¨]â”‚ â† ë°˜ê²½/ìƒˆë¡œê³ ì¹¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì£¼ë³€ ì£¼ì°¨ì¥ 15ê°œ (5ë¶„ ì „)    â”‚ â† ê°œìˆ˜/ì—…ë°ì´íŠ¸ ì‹œê°„
â”‚ [ì§€ë„] [ë¦¬ìŠ¤íŠ¸]             â”‚ â† ë·° ì „í™˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ì£¼ì°¨ì¥ í´ë¦­ ì‹œ BottomSheet]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê´‘í™”ë¬¸ ê³µì˜ì£¼ì°¨ì¥            â”‚
â”‚ ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì„¸ì¢…ëŒ€ë¡œ... â”‚
â”‚                             â”‚
â”‚ ì£¼ì°¨ ê°€ëŠ¥: 23 / 100 ëŒ€      â”‚ â† ê°•ì¡°
â”‚ ìš´ì˜ì‹œê°„: 24ì‹œê°„             â”‚
â”‚ ìš”ê¸ˆ: 10ë¶„ë‹¹ 500ì›           â”‚
â”‚ ì „í™”: 02-1234-5678          â”‚
â”‚ í˜„ì¬ ìœ„ì¹˜ë¡œë¶€í„° 450m         â”‚
â”‚ 5ë¶„ ì „ ì—…ë°ì´íŠ¸             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ê¸¸ì°¾ê¸°] [ì¦ê²¨ì°¾ê¸° ì¶”ê°€] [ê³µìœ ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Testing Strategy

### Unit Tests
- [ ] ParkingMapNotifier ìƒíƒœ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
- [ ] ì£¼ì°¨ì¥ ë§ˆì»¤ ìƒ‰ìƒ ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] ê±°ë¦¬ ê³„ì‚° ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] í•„í„°ë§ ë¡œì§ í…ŒìŠ¤íŠ¸

### Widget Tests
- [ ] ParkingMapScreen ì§€ë„ ë Œë”ë§ í…ŒìŠ¤íŠ¸
- [ ] ParkingDetailBottomSheet UI í…ŒìŠ¤íŠ¸
- [ ] í•„í„° í† ê¸€ í…ŒìŠ¤íŠ¸

### Integration Tests
- [ ] ì£¼ì°¨ì¥ ì¡°íšŒ â†’ ì§€ë„ í‘œì‹œ í”Œë¡œìš°
- [ ] í•„í„° ì ìš© â†’ ë§ˆì»¤ ì—…ë°ì´íŠ¸ í”Œë¡œìš°
- [ ] ê²½ë¡œ ì•ˆë‚´ í”Œë¡œìš°

### Performance Tests
- [ ] 100ê°œ ì£¼ì°¨ì¥ ë§ˆì»¤ ë Œë”ë§ ì„±ëŠ¥
- [ ] 30ë¶„ ìë™ ìƒˆë¡œê³ ì¹¨ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ì¸

## Deployment Checklist

### Pre-Deployment
- [ ] ì£¼ì°¨ì¥ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ (ì„œìš¸ ê³µì˜ ì£¼ì°¨ì¥)
- [ ] ì‹¤ì‹œê°„ ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ API í…ŒìŠ¤íŠ¸
- [ ] ì¹´ì¹´ì˜¤ë§µ/ë„¤ì´ë²„ë§µ URL ìŠ¤í‚´ í…ŒìŠ¤íŠ¸

### Deployment
- [ ] Android/iOS ë¹Œë“œ
- [ ] ì£¼ì°¨ë§µ ì‚¬ìš©ë¥  ì¶”ì  (Analytics)

### Post-Deployment
- [ ] ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ì •í™•ë„ ëª¨ë‹ˆí„°ë§
- [ ] ê²½ë¡œ ì•ˆë‚´ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§

## Risks & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| ì‹¤ì‹œê°„ ë°ì´í„° ë¶€ì •í™• | High | Medium | ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ëª…ì‹œ, ì‚¬ìš©ì í”¼ë“œë°± |
| ì„œìš¸ì‹œ API ì¥ì•  | High | Low | ìºì‹±, ì—ëŸ¬ ë©”ì‹œì§€ |
| ì£¼ì°¨ì¥ ìˆ˜ê°€ ì ìŒ (CCTV ëŒ€ë¹„) | Medium | Medium | ë¯¼ê°„ ì£¼ì°¨ì¥ ì¶”ê°€ (Phase 2) |

## Dependencies

### Depends On (Prerequisites)
- **CORE-002**: Geospatial Data Infrastructure
- **CORE-003**: Public Data Integration (ì£¼ì°¨ì¥ ë°ì´í„°)

### Blocks (Dependent Epics)
- **USR-006**: Integrated Safety Map (ì£¼ì°¨ì¥ + CCTV + ëŒ€í”¼ì†Œ í†µí•©)

## Related Epics

- **USR-003**: Safety Map (CCTV)
- **USR-005**: Safety Map (Disaster)
- **USR-006**: Integrated Safety Map

## Future Enhancements

### Phase 2
- ë¯¼ê°„ ì£¼ì°¨ì¥ ì •ë³´ (ì£¼ì°¨ì˜ ë‹¬ì¸, íŒŒí‚¹í´ë¼ìš°ë“œ API)
- ì£¼ì°¨ì¥ ë¦¬ë·°/í‰ì 
- ì£¼ì°¨ ìš”ê¸ˆ ê³„ì‚°ê¸°

### Phase 3
- ì£¼ì°¨ì¥ ì˜ˆì•½ (ì‚¬ì „ ì˜ˆì•½)
- ì£¼ì°¨ ìš”ê¸ˆ ì•± ë‚´ ê²°ì œ
- ì£¼ì°¨ íˆìŠ¤í† ë¦¬ (ì£¼ì°¨í•œ ê³³ ê¸°ë¡)

### Phase 4
- ë°œë › íŒŒí‚¹ ì„œë¹„ìŠ¤
- EV ì¶©ì „ì†Œ ì •ë³´ í†µí•©

## Notes

### ì£¼ì°¨ ê°€ëŠ¥ ëŒ€ìˆ˜ ìƒ‰ìƒ ë¡œì§
```dart
Color getParkingMarkerColor(int availableSpaces) {
  if (availableSpaces == 0) return Color(0xFFE53935); // Red
  if (availableSpaces <= 10) return Color(0xFFFDD835); // Yellow
  return Color(0xFF43A047); // Green
}
```

### ì¹´ì¹´ì˜¤ë§µ URL ìŠ¤í‚´
```dart
void openKakaoMap(Parking parking) {
  final url = 'kakaomap://route?'
      'sp=${currentLat},${currentLng}&'
      'ep=${parking.lat},${parking.lng}&'
      'by=CAR';
  launchUrl(Uri.parse(url));
}
```

### Flutter Packages
```yaml
dependencies:
  url_launcher: ^6.2.0
  intl: ^0.18.0 # ìš”ê¸ˆ í¬ë§·íŒ…
```

### References
- ì„œìš¸ì‹œ ì£¼ì°¨ì¥ API: https://data.seoul.go.kr/
- ì¹´ì¹´ì˜¤ë§µ URL ìŠ¤í‚´: https://developers.kakao.com/docs/latest/ko/local/dev-guide
- ë„¤ì´ë²„ë§µ URL ìŠ¤í‚´: https://guide.ncloud-docs.com/docs/navermaps-ios-url-scheme
