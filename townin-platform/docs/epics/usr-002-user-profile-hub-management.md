# Epic: USR-002 - User Profile & Hub Management

## Epic Overview

| Field | Value |
|-------|-------|
| **Epic ID** | USR-002 |
| **Epic Title** | User Profile & Hub Management |
| **Priority** | P0 (Critical) |
| **Status** | ğŸ“‹ PLANNED |
| **Estimated Effort** | 5 days |
| **Actual Effort** | - |
| **Start Date** | TBD |
| **End Date** | TBD |
| **Phase** | Phase 1 - Traffic Acquisition (User App) |
| **Category** | USR - User App |
| **Owner** | Mobile Team (Flutter) |

## Business Value

### Problem Statement
ì‚¬ìš©ìëŠ” ì˜¨ë³´ë”© í›„ì—ë„ í”„ë¡œí•„ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜, 3-Hub ìœ„ì¹˜ë¥¼ ë³€ê²½/ì¶”ê°€í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì‚¬, ì´ì§, ê°€ì¡± ì´ë™ ë“± ìƒí™œ ë³€í™”ì— ë”°ë¼ ìœ„ì¹˜ ì •ë³´ë¥¼ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ì•¼ ì„œë¹„ìŠ¤ í™œìš©ë„ê°€ ìœ ì§€ë©ë‹ˆë‹¤.

### Business Value
- **ì‚¬ìš©ì ìœ ì§€**: ìœ„ì¹˜ ë³€ê²½ ì‹œ ì„œë¹„ìŠ¤ ì´íƒˆ ë°©ì§€
- **ë°ì´í„° ì •í™•ë„**: ìµœì‹  ìœ„ì¹˜ ì •ë³´ë¡œ ì •í™•í•œ ì „ë‹¨ì§€ ë…¸ì¶œ
- **í”„ë¡œí•„ ì™„ì„±ë„**: í”„ë¡œí•„ ì‚¬ì§„, ë‹‰ë„¤ì„ ë“±ìœ¼ë¡œ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬ ìœ ë„
- **ê°œì¸í™”**: ì•Œë¦¼ ì„¤ì •, ê´€ì‹¬ ì¹´í…Œê³ ë¦¬ë¡œ ë§ì¶¤ ì„œë¹„ìŠ¤ ì œê³µ

### Target Users
- **ì¼ë°˜ ì‚¬ìš©ì**: í”„ë¡œí•„ ìˆ˜ì •, ìœ„ì¹˜ ê´€ë¦¬
- **í™œì„± ì‚¬ìš©ì**: í”„ë¡œí•„ ì‚¬ì§„, ë‹‰ë„¤ì„ ì„¤ì •ìœ¼ë¡œ ì»¤ë®¤ë‹ˆí‹° ì°¸ì—¬

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| í”„ë¡œí•„ ì™„ì„±ë„ | â‰¥ 70% | í”„ë¡œí•„ ì‚¬ì§„ + ë‹‰ë„¤ì„ ì„¤ì • ë¹„ìœ¨ |
| ìœ„ì¹˜ ë³€ê²½ ì„±ê³µë¥  | â‰¥ 95% | ìœ„ì¹˜ ë³€ê²½ ì‹œë„ ëŒ€ë¹„ ì„±ê³µ ë¹„ìœ¨ |
| ì„¤ì • í˜ì´ì§€ ë°©ë¬¸ìœ¨ | â‰¥ 30% | ì›” 1íšŒ ì´ìƒ ì„¤ì • í˜ì´ì§€ ë°©ë¬¸ |
| í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œìœ¨ | â‰¥ 40% | ì‚¬ìš©ì ì¤‘ í”„ë¡œí•„ ì‚¬ì§„ ì„¤ì • ë¹„ìœ¨ |

## Epic Scope

### In Scope
âœ… **í”„ë¡œí•„ ê´€ë¦¬**
- í”„ë¡œí•„ ì¡°íšŒ (ë‚´ ì •ë³´ í™”ë©´)
- í”„ë¡œí•„ ìˆ˜ì • (ì´ë¦„, ë‹‰ë„¤ì„, í”„ë¡œí•„ ì‚¬ì§„)
- í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ
- ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ ë³€ê²½

âœ… **3-Hub ìœ„ì¹˜ ê´€ë¦¬**
- ìœ„ì¹˜ ëª©ë¡ ì¡°íšŒ
- ìœ„ì¹˜ ì¶”ê°€ (ìµœëŒ€ 3ê°œ)
- ìœ„ì¹˜ ìˆ˜ì •
- ìœ„ì¹˜ ì‚­ì œ
- ì£¼ í™œë™ ì§€ì—­ ì„¤ì •

âœ… **ê³„ì • ì„¤ì •**
- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
- ì•Œë¦¼ ì„¤ì • (ì¹´í…Œê³ ë¦¬ë³„ ON/OFF)
- ì•¼ê°„ ì•Œë¦¼ ì°¨ë‹¨ ì„¤ì •
- ì–¸ì–´ ì„¤ì • (í•œêµ­ì–´/ì˜ì–´)

âœ… **ê³„ì • ê´€ë¦¬**
- ë¡œê·¸ì•„ì›ƒ
- íšŒì› íƒˆí‡´
- ì—°ê²°ëœ ì†Œì…œ ê³„ì • í™•ì¸

### Out of Scope
âŒ ì¹œêµ¬ ê´€ë¦¬ (íŒ”ë¡œìš°/íŒ”ë¡œì‰) - Phase 2
âŒ í™œë™ ë‚´ì—­ (ì „ë‹¨ì§€ ì¡°íšŒ ì´ë ¥) - Phase 2
âŒ í¬ì¸íŠ¸ ë‚´ì—­ - USR-009 (ë³„ë„ Epic)
âŒ ê´€ì‹¬ ì¹´í…Œê³ ë¦¬ ì„¤ì • - Phase 2

## User Stories

### Story 2.1: ë‚´ ì •ë³´ í™”ë©´
**As a** ì‚¬ìš©ì
**I want to** ë‚´ í”„ë¡œí•„ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³ 
**So that** í˜„ì¬ ì„¤ì •ëœ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] í”„ë¡œí•„ ì‚¬ì§„ (ê¸°ë³¸ ì•„ë°”íƒ€ or ì—…ë¡œë“œí•œ ì´ë¯¸ì§€)
- [ ] ì´ë¦„, ë‹‰ë„¤ì„
- [ ] ì´ë©”ì¼, ì „í™”ë²ˆí˜¸
- [ ] ê°€ì… ë‚ ì§œ, íšŒì› ë“±ê¸‰ (ì¼ë°˜/VIP - Phase 3)
- [ ] ë“±ë¡ëœ 3-Hub ìœ„ì¹˜ ë¯¸ë¦¬ë³´ê¸°
- [ ] "í”„ë¡œí•„ ìˆ˜ì •" ë²„íŠ¼

**Tasks:**
- [ ] ProfileScreen ìœ„ì ¯ ì‘ì„±
- [ ] GET /api/auth/me API í˜¸ì¶œ
- [ ] í”„ë¡œí•„ ì •ë³´ UI ë””ìì¸
- [ ] ìºì‹± (ë¡œì»¬ ì €ì¥ + ì„œë²„ ë™ê¸°í™”)

**Story Points:** 3

---

### Story 2.2: í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ
**As a** ì‚¬ìš©ì
**I want to** í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ê³ 
**So that** ë‚˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì´ë¯¸ì§€ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "ì‚¬ì§„ ë³€ê²½" ë²„íŠ¼ í´ë¦­
- [ ] 2ê°€ì§€ ì˜µì…˜: "ê°¤ëŸ¬ë¦¬ì—ì„œ ì„ íƒ", "ì¹´ë©”ë¼ë¡œ ì´¬ì˜"
- [ ] ì´ë¯¸ì§€ í¬ë¡­ (1:1 ì •ì‚¬ê°í˜•)
- [ ] ì—…ë¡œë“œ ì§„í–‰ë¥  í‘œì‹œ
- [ ] ì—…ë¡œë“œ ì„±ê³µ ì‹œ ì¦‰ì‹œ ë°˜ì˜

**Tasks:**
- [ ] image_picker íŒ¨í‚¤ì§€ ì‚¬ìš©
- [ ] image_cropper íŒ¨í‚¤ì§€ ì‚¬ìš©
- [ ] POST /api/files/presigned-url â†’ S3 ì—…ë¡œë“œ
- [ ] PATCH /api/auth/me (profileImageUrl ì—…ë°ì´íŠ¸)

**Story Points:** 5

---

### Story 2.3: í”„ë¡œí•„ ìˆ˜ì •
**As a** ì‚¬ìš©ì
**I want to** ì´ë¦„, ë‹‰ë„¤ì„, ì „í™”ë²ˆí˜¸ë¥¼ ìˆ˜ì •í•˜ê³ 
**So that** ìµœì‹  ì •ë³´ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìˆ˜ì • ê°€ëŠ¥ í•„ë“œ: ì´ë¦„, ë‹‰ë„¤ì„, ì „í™”ë²ˆí˜¸
- [ ] ì‹¤ì‹œê°„ ê²€ì¦ (ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸)
- [ ] "ì €ì¥" ë²„íŠ¼
- [ ] ì €ì¥ ì„±ê³µ ì‹œ í† ìŠ¤íŠ¸ ë©”ì‹œì§€

**Tasks:**
- [ ] EditProfileScreen ìœ„ì ¯ ì‘ì„±
- [ ] Form Validation
- [ ] PATCH /api/auth/me API í˜¸ì¶œ
- [ ] ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ API (GET /api/users/check-nickname?nickname=...)

**Story Points:** 3

---

### Story 2.4: 3-Hub ìœ„ì¹˜ ëª©ë¡ ì¡°íšŒ
**As a** ì‚¬ìš©ì
**I want to** ë“±ë¡ëœ ìœ„ì¹˜ ëª©ë¡ì„ ë³´ê³ 
**So that** ì–´ë–¤ ìœ„ì¹˜ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìœ„ì¹˜ ì¹´ë“œ UI (ê±°ì£¼ì§€, ì§ì¥, ê°€ì¡±ì§‘)
- [ ] ê° ìœ„ì¹˜: íƒ€ì…, ì£¼ì†Œ, ì§€ë„ ë¯¸ë¦¬ë³´ê¸°
- [ ] "ìœ„ì¹˜ ì¶”ê°€" ë²„íŠ¼ (ìµœëŒ€ 3ê°œ ì œí•œ)
- [ ] ê° ìœ„ì¹˜ ì¹´ë“œì— "ìˆ˜ì •", "ì‚­ì œ" ë²„íŠ¼
- [ ] ì£¼ í™œë™ ì§€ì—­ í‘œì‹œ (ë³„ ì•„ì´ì½˜)

**Tasks:**
- [ ] LocationListScreen ìœ„ì ¯ ì‘ì„±
- [ ] GET /api/users/me/locations API í˜¸ì¶œ
- [ ] ìœ„ì¹˜ ì¹´ë“œ UI ì»´í¬ë„ŒíŠ¸

**Story Points:** 3

---

### Story 2.5: ìœ„ì¹˜ ì¶”ê°€
**As a** ì‚¬ìš©ì
**I want to** ìƒˆë¡œìš´ ìœ„ì¹˜ë¥¼ ì¶”ê°€í•˜ê³ 
**So that** ìµœëŒ€ 3ê³³ì˜ ìœ„ì¹˜ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì˜¨ë³´ë”©ê³¼ ë™ì¼í•œ ìœ„ì¹˜ ë“±ë¡ UI ì¬ì‚¬ìš©
- [ ] ìµœëŒ€ 3ê°œ ì œí•œ (ì´ë¯¸ 3ê°œë©´ "ì¶”ê°€" ë²„íŠ¼ ë¹„í™œì„±í™”)
- [ ] ìœ„ì¹˜ íƒ€ì… ì„ íƒ (ê±°ì£¼ì§€/ì§ì¥/ê°€ì¡±ì§‘)
- [ ] ì£¼ì†Œ ê²€ìƒ‰ or GPS or ì§€ë„ ì„ íƒ

**Tasks:**
- [ ] LocationRegistrationScreen ì¬ì‚¬ìš©
- [ ] POST /api/users/me/locations API í˜¸ì¶œ
- [ ] ìµœëŒ€ 3ê°œ ì œí•œ ê²€ì¦

**Story Points:** 2

---

### Story 2.6: ìœ„ì¹˜ ìˆ˜ì •
**As a** ì‚¬ìš©ì
**I want to** ê¸°ì¡´ ìœ„ì¹˜ë¥¼ ìˆ˜ì •í•˜ê³ 
**So that** ì´ì‚¬ë‚˜ ì´ì§ ì‹œ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìœ„ì¹˜ ì¹´ë“œì—ì„œ "ìˆ˜ì •" ë²„íŠ¼ í´ë¦­
- [ ] í˜„ì¬ ìœ„ì¹˜ ì •ë³´ ë¯¸ë¦¬ ì±„ì›Œì§
- [ ] ì£¼ì†Œ ë³€ê²½ ê°€ëŠ¥
- [ ] ì €ì¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜

**Tasks:**
- [ ] PATCH /api/users/me/locations/:id API í˜¸ì¶œ
- [ ] ìœ„ì¹˜ ìˆ˜ì • UI (LocationRegistrationScreen ì¬ì‚¬ìš©)

**Story Points:** 2

---

### Story 2.7: ìœ„ì¹˜ ì‚­ì œ
**As a** ì‚¬ìš©ì
**I want to** ë¶ˆí•„ìš”í•œ ìœ„ì¹˜ë¥¼ ì‚­ì œí•˜ê³ 
**So that** ê´€ë¦¬í•˜ê¸° ì‰½ê²Œ ìœ„ì¹˜ë¥¼ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìœ„ì¹˜ ì¹´ë“œì—ì„œ "ì‚­ì œ" ë²„íŠ¼ í´ë¦­
- [ ] ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ ("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
- [ ] ì‚­ì œ ì„±ê³µ ì‹œ ëª©ë¡ì—ì„œ ì œê±°
- [ ] ìµœì†Œ 1ê°œëŠ” ë‚¨ì•„ì•¼ í•¨ (ëª¨ë‘ ì‚­ì œ ë¶ˆê°€)

**Tasks:**
- [ ] DELETE /api/users/me/locations/:id API í˜¸ì¶œ
- [ ] ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ UI
- [ ] ìµœì†Œ 1ê°œ ì œí•œ ë¡œì§

**Story Points:** 2

---

### Story 2.8: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
**As a** ì‚¬ìš©ì
**I want to** ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ê³ 
**So that** ê³„ì • ë³´ì•ˆì„ ìœ ì§€í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
- [ ] ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ìµœì†Œ 8ì, ì˜ë¬¸+ìˆ«ì+íŠ¹ìˆ˜ë¬¸ì)
- [ ] ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
- [ ] ì‹¤ì‹œê°„ ê²€ì¦ (ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ í™•ì¸)
- [ ] ë³€ê²½ ì„±ê³µ ì‹œ ë¡œê·¸ì•„ì›ƒ (ì¬ë¡œê·¸ì¸ í•„ìš”)

**Tasks:**
- [ ] ChangePasswordScreen ìœ„ì ¯ ì‘ì„±
- [ ] POST /api/auth/change-password API í˜¸ì¶œ
- [ ] ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë¡œì§

**Story Points:** 3

---

### Story 2.9: ì•Œë¦¼ ì„¤ì •
**As a** ì‚¬ìš©ì
**I want to** ì•Œë¦¼ ìˆ˜ì‹  ì—¬ë¶€ë¥¼ ì„¤ì •í•˜ê³ 
**So that** ì›í•˜ëŠ” ì•Œë¦¼ë§Œ ë°›ì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì¹´í…Œê³ ë¦¬ë³„ ì•Œë¦¼ ON/OFF í† ê¸€
  - ì „ë‹¨ì§€ ì•Œë¦¼
  - í¬ì¸íŠ¸ ì ë¦½ ì•Œë¦¼
  - ì‹œìŠ¤í…œ ê³µì§€
  - ê°€ì¡± ëŒë´„ ì•Œë¦¼ (Phase 2)
- [ ] ì•¼ê°„ ì•Œë¦¼ ì°¨ë‹¨ (22:00 ~ 08:00)
- [ ] ì•¼ê°„ ì‹œê°„ëŒ€ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- [ ] ì €ì¥ ì‹œ ì¦‰ì‹œ ë°˜ì˜

**Tasks:**
- [ ] NotificationSettingsScreen ìœ„ì ¯ ì‘ì„±
- [ ] GET /api/users/me/notification-preferences
- [ ] PATCH /api/users/me/notification-preferences

**Story Points:** 3

---

### Story 2.10: íšŒì› íƒˆí‡´
**As a** ì‚¬ìš©ì
**I want to** ê³„ì •ì„ ì‚­ì œí•˜ê³ 
**So that** ë” ì´ìƒ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "íšŒì› íƒˆí‡´" ë²„íŠ¼ (ì„¤ì • ìµœí•˜ë‹¨)
- [ ] íƒˆí‡´ ì‚¬ìœ  ì„ íƒ (ì„ íƒ ì‚¬í•­)
- [ ] íƒˆí‡´ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (ê²½ê³  ë¬¸êµ¬)
- [ ] ë¹„ë°€ë²ˆí˜¸ ì¬í™•ì¸
- [ ] íƒˆí‡´ ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
- [ ] íƒˆí‡´ í›„ 30ì¼ê°„ ë°ì´í„° ë³´ê´€ (ë³µêµ¬ ê°€ëŠ¥)

**Tasks:**
- [ ] DeleteAccountScreen ìœ„ì ¯ ì‘ì„±
- [ ] POST /api/auth/delete-account API í˜¸ì¶œ
- [ ] íƒˆí‡´ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ UI

**Story Points:** 3

## Technical Specifications

### Technology Stack
- **Framework**: Flutter 3.x
- **State Management**: Riverpod
- **Image Handling**: image_picker, image_cropper
- **Local Storage**: SharedPreferences, flutter_secure_storage
- **HTTP Client**: Dio

### Architecture Decisions

#### 1. í”„ë¡œí•„ ë°ì´í„° ìºì‹±
**Decision**: Local Storage + Server Sync

**Rationale**:
- **ì˜¤í”„ë¼ì¸ ì§€ì›**: ë„¤íŠ¸ì›Œí¬ ì—†ì–´ë„ í”„ë¡œí•„ ì¡°íšŒ ê°€ëŠ¥
- **ì„±ëŠ¥**: ë¹ ë¥¸ í™”ë©´ ë¡œë”©
- **ë™ê¸°í™”**: ì•± ì‹œì‘ ì‹œ ì„œë²„ì™€ ë™ê¸°í™”

**êµ¬í˜„**:
```dart
// ìºì‹œ ìš°ì„ , ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”
Future<User> getProfile() async {
  // 1. ìºì‹œì—ì„œ ë¨¼ì € ë¡œë“œ
  final cachedUser = await _loadFromCache();

  // 2. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  _syncFromServer().then((serverUser) {
    if (serverUser != cachedUser) {
      _saveToCache(serverUser);
      _notifyListeners(serverUser);
    }
  });

  return cachedUser;
}
```

#### 2. í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ ì „ëµ
**Decision**: Presigned URL + S3 Direct Upload

**Rationale**:
- **ì†ë„**: ì„œë²„ë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ ë¹ ë¦„
- **ì„œë²„ ë¶€í•˜**: ì„œë²„ ëŒ€ì—­í­ ì ˆì•½
- **í™•ì¥ì„±**: S3 ë¬´ì œí•œ ìŠ¤í† ë¦¬ì§€

### Database Schema (Backend)

#### User Table í™•ì¥
```sql
-- ê¸°ì¡´ User í…Œì´ë¸”ì— ì¶”ê°€ ì»¬ëŸ¼
ALTER TABLE users ADD COLUMN nickname VARCHAR(50) UNIQUE;
ALTER TABLE users ADD COLUMN profile_image_url TEXT;
ALTER TABLE users ADD COLUMN bio TEXT;
ALTER TABLE users ADD COLUMN language VARCHAR(10) DEFAULT 'ko';

CREATE INDEX idx_users_nickname ON users(nickname);
```

### API Endpoints

#### Profile APIs

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/auth/me` | ë‚´ ì •ë³´ ì¡°íšŒ | Yes | All |
| PATCH | `/api/auth/me` | í”„ë¡œí•„ ìˆ˜ì • | Yes | All |
| POST | `/api/auth/change-password` | ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ | Yes | All |
| POST | `/api/auth/delete-account` | íšŒì› íƒˆí‡´ | Yes | All |
| GET | `/api/users/check-nickname?nickname=í™ê¸¸ë™` | ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ | No | - |

#### Location APIs

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/users/me/locations` | ìœ„ì¹˜ ëª©ë¡ ì¡°íšŒ | Yes | user, merchant |
| POST | `/api/users/me/locations` | ìœ„ì¹˜ ì¶”ê°€ | Yes | user, merchant |
| PATCH | `/api/users/me/locations/:id` | ìœ„ì¹˜ ìˆ˜ì • | Yes | user, merchant |
| DELETE | `/api/users/me/locations/:id` | ìœ„ì¹˜ ì‚­ì œ | Yes | user, merchant |
| PATCH | `/api/users/me/locations/:id/primary` | ì£¼ í™œë™ ì§€ì—­ ì„¤ì • | Yes | user, merchant |

#### Notification Preference APIs

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/users/me/notification-preferences` | ì•Œë¦¼ ì„¤ì • ì¡°íšŒ | Yes | All |
| PATCH | `/api/users/me/notification-preferences` | ì•Œë¦¼ ì„¤ì • ìˆ˜ì • | Yes | All |

### Request/Response Examples

#### PATCH /api/auth/me
**Request:**
```json
{
  "name": "í™ê¸¸ë™",
  "nickname": "íƒ€ìš´ì¸ë§ˆìŠ¤í„°",
  "phone": "010-1234-5678",
  "profileImageUrl": "https://cdn.townin.kr/users/2025/02/uuid.jpg"
}
```

**Response (200 OK):**
```json
{
  "id": "user-uuid",
  "email": "user@example.com",
  "name": "í™ê¸¸ë™",
  "nickname": "íƒ€ìš´ì¸ë§ˆìŠ¤í„°",
  "phone": "010-1234-5678",
  "profileImageUrl": "https://cdn.townin.kr/users/2025/02/uuid.jpg",
  "role": "user",
  "createdAt": "2025-01-15T10:00:00Z"
}
```

#### GET /api/users/me/locations
**Response (200 OK):**
```json
{
  "data": [
    {
      "id": "location-uuid-1",
      "locationType": "home",
      "location": {
        "type": "Point",
        "coordinates": [126.9780, 37.5665]
      },
      "address": {
        "full": "ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì„¸ì¢…ëŒ€ë¡œ 209",
        "city": "ì„œìš¸íŠ¹ë³„ì‹œ",
        "district": "ì¢…ë¡œêµ¬",
        "neighborhood": "ì„¸ì¢…ë¡œ"
      },
      "isPrimary": true,
      "createdAt": "2025-01-15T10:00:00Z"
    },
    {
      "id": "location-uuid-2",
      "locationType": "work",
      "location": {
        "type": "Point",
        "coordinates": [127.0276, 37.4979]
      },
      "address": {
        "full": "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 152",
        "city": "ì„œìš¸íŠ¹ë³„ì‹œ",
        "district": "ê°•ë‚¨êµ¬",
        "neighborhood": "ì—­ì‚¼ë™"
      },
      "isPrimary": false,
      "createdAt": "2025-01-15T10:05:00Z"
    }
  ]
}
```

#### PATCH /api/users/me/notification-preferences
**Request:**
```json
{
  "flyerEnabled": true,
  "pointsEnabled": true,
  "systemEnabled": false,
  "quietHoursEnabled": true,
  "quietHoursStart": "22:00",
  "quietHoursEnd": "08:00"
}
```

**Response (200 OK):**
```json
{
  "id": "preference-uuid",
  "userId": "user-uuid",
  "flyerEnabled": true,
  "pointsEnabled": true,
  "systemEnabled": false,
  "careEnabled": true,
  "quietHoursEnabled": true,
  "quietHoursStart": "22:00",
  "quietHoursEnd": "08:00",
  "updatedAt": "2025-02-01T10:00:00Z"
}
```

### Screen Flow
```
ì„¤ì • í™”ë©´
â”œâ”€â”€ ë‚´ ì •ë³´
â”‚   â”œâ”€â”€ í”„ë¡œí•„ ì‚¬ì§„ ë³€ê²½
â”‚   â”œâ”€â”€ í”„ë¡œí•„ ìˆ˜ì •
â”‚   â””â”€â”€ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
â”œâ”€â”€ ë‚´ ìœ„ì¹˜ ê´€ë¦¬
â”‚   â”œâ”€â”€ ìœ„ì¹˜ ëª©ë¡
â”‚   â”œâ”€â”€ ìœ„ì¹˜ ì¶”ê°€
â”‚   â”œâ”€â”€ ìœ„ì¹˜ ìˆ˜ì •
â”‚   â””â”€â”€ ìœ„ì¹˜ ì‚­ì œ
â”œâ”€â”€ ì•Œë¦¼ ì„¤ì •
â”‚   â”œâ”€â”€ ì¹´í…Œê³ ë¦¬ë³„ ì•Œë¦¼
â”‚   â””â”€â”€ ì•¼ê°„ ì•Œë¦¼ ì°¨ë‹¨
â”œâ”€â”€ ê³„ì •
â”‚   â”œâ”€â”€ ë¡œê·¸ì•„ì›ƒ
â”‚   â””â”€â”€ íšŒì› íƒˆí‡´
â””â”€â”€ ì•± ì •ë³´
    â”œâ”€â”€ ë²„ì „ ì •ë³´
    â”œâ”€â”€ ì´ìš©ì•½ê´€
    â””â”€â”€ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
```

### State Management (Riverpod)
```dart
// user_profile_provider.dart
final userProfileProvider = StateNotifierProvider<UserProfileNotifier, AsyncValue<User>>((ref) {
  return UserProfileNotifier(ref.read(apiServiceProvider));
});

class UserProfileNotifier extends StateNotifier<AsyncValue<User>> {
  UserProfileNotifier(this._apiService) : super(const AsyncValue.loading()) {
    loadProfile();
  }

  final ApiService _apiService;

  Future<void> loadProfile() async {
    state = const AsyncValue.loading();
    try {
      final user = await _apiService.getProfile();
      state = AsyncValue.data(user);
    } catch (e, stack) {
      state = AsyncValue.error(e, stack);
    }
  }

  Future<void> updateProfile({
    String? name,
    String? nickname,
    String? phone,
    String? profileImageUrl,
  }) async {
    try {
      final updatedUser = await _apiService.updateProfile(
        name: name,
        nickname: nickname,
        phone: phone,
        profileImageUrl: profileImageUrl,
      );
      state = AsyncValue.data(updatedUser);
    } catch (e, stack) {
      state = AsyncValue.error(e, stack);
      rethrow;
    }
  }
}
```

## Testing Strategy

### Unit Tests
- [ ] UserProfileNotifier ìƒíƒœ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
- [ ] ë‹‰ë„¤ì„ ê²€ì¦ ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë¡œì§ í…ŒìŠ¤íŠ¸

### Widget Tests
- [ ] ProfileScreen UI í…ŒìŠ¤íŠ¸
- [ ] EditProfileScreen Form Validation í…ŒìŠ¤íŠ¸
- [ ] LocationListScreen ìœ„ì¹˜ ì¹´ë“œ ë Œë”ë§ í…ŒìŠ¤íŠ¸

### Integration Tests
- [ ] í”„ë¡œí•„ ìˆ˜ì • í”Œë¡œìš° (ìˆ˜ì • â†’ ì €ì¥ â†’ í™•ì¸)
- [ ] ìœ„ì¹˜ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ í”Œë¡œìš°
- [ ] í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ í”Œë¡œìš°

## Deployment Checklist

### Pre-Deployment
- [ ] S3 ë²„í‚· ê¶Œí•œ í™•ì¸ (í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ)
- [ ] ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ API ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- [ ] íšŒì› íƒˆí‡´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

### Deployment
- [ ] Android/iOS ë¹Œë“œ
- [ ] í”„ë¡œí•„ ì™„ì„±ë„ ì¶”ì  Analytics ì„¤ì •

### Post-Deployment
- [ ] í”„ë¡œí•„ ì™„ì„±ë„ ëª¨ë‹ˆí„°ë§
- [ ] ìœ„ì¹˜ ë³€ê²½ ì„±ê³µë¥  ëª¨ë‹ˆí„°ë§
- [ ] íšŒì› íƒˆí‡´ ì‚¬ìœ  ë¶„ì„

## Risks & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ ì‹¤íŒ¨ | Medium | Medium | ì¬ì‹œë„ ë²„íŠ¼, ì´ë¯¸ì§€ ì••ì¶• |
| ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ ì§€ì—° | Low | Medium | Debouncing (500ms ì§€ì—° í›„ API í˜¸ì¶œ) |
| ìœ„ì¹˜ ì‚­ì œ ì‹œ ë°ì´í„° ì†ì‹¤ | Medium | Low | Soft Delete (30ì¼ í›„ ì˜êµ¬ ì‚­ì œ) |
| íšŒì› íƒˆí‡´ í›„ ë³µêµ¬ ìš”ì²­ | Medium | Low | 30ì¼ ë³´ê´€, ë³µêµ¬ API ì œê³µ |

## Dependencies

### Depends On (Prerequisites)
- **CORE-001**: Authentication & Authorization System
- **CORE-002**: Geospatial Data Infrastructure (ìœ„ì¹˜ ê´€ë¦¬)
- **CORE-005**: File Upload & CDN (í”„ë¡œí•„ ì‚¬ì§„)
- **USR-001**: User Onboarding

### Blocks (Dependent Epics)
- All other User App Epics (í”„ë¡œí•„/ìœ„ì¹˜ ì •ë³´ ì‚¬ìš©)

## Related Epics

- **USR-001**: User Onboarding (ìµœì´ˆ ìœ„ì¹˜ ë“±ë¡)
- **USR-009**: User Points & Rewards (í¬ì¸íŠ¸ ë‚´ì—­)

## Future Enhancements

### Phase 2
- í”„ë¡œí•„ ë±ƒì§€ ì‹œìŠ¤í…œ (í™œë™ ë ˆë²¨)
- ì¹œêµ¬ ê´€ë¦¬ (íŒ”ë¡œìš°/íŒ”ë¡œì‰)
- í™œë™ ë‚´ì—­ (ì „ë‹¨ì§€ ì¡°íšŒ, ëŒ“ê¸€)
- ê´€ì‹¬ ì¹´í…Œê³ ë¦¬ ì„¤ì •

### Phase 3
- AI ê¸°ë°˜ í”„ë¡œí•„ ì¶”ì²œ (ë‹‰ë„¤ì„, ì‚¬ì§„)
- ì†Œì…œ ê·¸ë˜í”„ (ì¹œêµ¬ ì¶”ì²œ)
- í”„ë¡œí•„ ê³µê°œ/ë¹„ê³µê°œ ì„¤ì •

### Phase 4
- ë‹¤êµ­ì–´ í”„ë¡œí•„ (ì˜ì–´, ë² íŠ¸ë‚¨ì–´, ì¼ë³¸ì–´)
- ë¸”ë¡ì²´ì¸ ê¸°ë°˜ í”„ë¡œí•„ ì¸ì¦

## Notes

### í”„ë¡œí•„ ì™„ì„±ë„ ê³„ì‚°
```dart
int calculateProfileCompleteness(User user) {
  int score = 0;

  if (user.name != null && user.name!.isNotEmpty) score += 20;
  if (user.nickname != null) score += 20;
  if (user.profileImageUrl != null) score += 30;
  if (user.phone != null) score += 10;
  if (user.locations.length >= 3) score += 20;

  return score; // 0-100
}
```

### Flutter Packages
```yaml
dependencies:
  image_picker: ^1.0.0
  image_cropper: ^5.0.0
  cached_network_image: ^3.3.0
  flutter_riverpod: ^2.4.0
```

### References
- Flutter Image Picker: https://pub.dev/packages/image_picker
- Flutter Image Cropper: https://pub.dev/packages/image_cropper
- Material Design - User Profile: https://m3.material.io/
