# Epic: USR-003 - Safety Map (CCTV)

## Epic Overview

| Field | Value |
|-------|-------|
| **Epic ID** | USR-003 |
| **Epic Title** | Safety Map (CCTV) |
| **Priority** | P0 (Critical) |
| **Status** | ğŸ“‹ PLANNED |
| **Estimated Effort** | 6 days |
| **Actual Effort** | - |
| **Start Date** | TBD |
| **End Date** | TBD |
| **Phase** | Phase 1 - Traffic Acquisition (User App) |
| **Category** | USR - User App |
| **Owner** | Mobile Team (Flutter) |

## Business Value

### Problem Statement
íƒ€ìš´ì¸ì˜ Phase 1 ì „ëµì€ **ê³µê³µ ë°ì´í„°ë¡œ ë¬´ë£Œ Trafficì„ í™•ë³´**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. CCTV ì•ˆì „ë§µì€ í•™ë¶€ëª¨, ì—¬ì„±, ê³ ë ¹ìì—ê²Œ ë§¤ë ¥ì ì¸ ê¸°ëŠ¥ìœ¼ë¡œ, ê´‘ê³  ì—†ì´ ìˆœìˆ˜í•œ ê°€ì¹˜ë¥¼ ì œê³µí•˜ì—¬ ì•± ì„¤ì¹˜ë¥¼ ìœ ë„í•©ë‹ˆë‹¤.

### Business Value
- **Traffic Anchor**: CCTV ë§µìœ¼ë¡œ ê²€ìƒ‰ ìœ ì…, ì…ì†Œë¬¸ í™•ëŒ€
- **ì‹ ë¢°ë„ êµ¬ì¶•**: ê³µê³µ ë°ì´í„°ë¡œ í”Œë«í¼ ì‹ ë¢°ì„± í™•ë³´
- **ì‚¬ìš©ì ì°¸ì—¬**: ì•ˆì „ ê²½ë¡œ ì°¾ê¸°ë¡œ ì¼ìƒì  ì‚¬ìš© ìœ ë„
- **SEO**: "ìš°ë¦¬ ë™ë„¤ CCTV ì§€ë„" ê²€ìƒ‰ ë…¸ì¶œ

### Target Users
- **í•™ë¶€ëª¨**: ì•„ì´ ë“±í•˜êµ£ê¸¸ CCTV í™•ì¸
- **ì—¬ì„±**: ì•¼ê°„ ê·€ê°€ ì•ˆì „ ê²½ë¡œ
- **ê³ ë ¹ì**: ì‚°ì±…ë¡œ CCTV ìœ„ì¹˜
- **ì§€ì—­ ì£¼ë¯¼**: ë™ë„¤ ì•ˆì „ë„ íŒŒì•…

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| CCTV ë§µ ì‚¬ìš©ë¥  | â‰¥ 50% | ì‚¬ìš©ì ì¤‘ CCTV ë§µ ì§„ì… ë¹„ìœ¨ |
| ì•ˆì „ ê²½ë¡œ ì°¾ê¸° ì‚¬ìš© | â‰¥ 20% | CCTV ë§µ ì‚¬ìš©ì ì¤‘ ê²½ë¡œ ì°¾ê¸° ì‚¬ìš© ë¹„ìœ¨ |
| ì§€ë„ ë¡œë”© ì‹œê°„ | < 2ì´ˆ | CCTV ë§ˆì»¤ ë¡œë“œ í‰ê·  ì‹œê°„ |
| ì¬ë°©ë¬¸ìœ¨ | â‰¥ 30% | ì£¼ 1íšŒ ì´ìƒ CCTV ë§µ ì¬ë°©ë¬¸ |
| ê³µìœ  íšŸìˆ˜ | - | CCTV ë§µ ê³µìœ  ê¸°ëŠ¥ ì‚¬ìš© íšŸìˆ˜ |

## Epic Scope

### In Scope
âœ… **CCTV ì§€ë„ ë·°ì–´**
- ì§€ë„ ìœ„ CCTV ë§ˆì»¤ í‘œì‹œ
- í˜„ì¬ ìœ„ì¹˜ ì¤‘ì‹¬ ì§€ë„
- CCTV ë°€ë„ íˆíŠ¸ë§µ (ì„ íƒ ì‚¬í•­)
- ì§€ë„ í™•ëŒ€/ì¶•ì†Œ

âœ… **CCTV ê²€ìƒ‰ ë° í•„í„°**
- ì£¼ì†Œ ê²€ìƒ‰
- ë°˜ê²½ ê²€ìƒ‰ (500m, 1km, 2km)
- ì„¤ì¹˜ ê¸°ê´€ë³„ í•„í„° (ì„œìš¸ì‹œ, êµ¬ì²­, ê²½ì°°ì„œ)
- ì„¤ì¹˜ ëª©ì ë³„ í•„í„° (ë°©ë²”, êµí†µ)

âœ… **CCTV ìƒì„¸ ì •ë³´**
- CCTV ìœ„ì¹˜ëª…
- ì„¤ì¹˜ ê¸°ê´€
- ì„¤ì¹˜ ëª©ì 
- ì£¼ì†Œ
- ê±°ë¦¬ (í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€)

âœ… **ì•ˆì „ ê²½ë¡œ ì°¾ê¸°**
- ì¶œë°œì§€ â†’ ë„ì°©ì§€ ê²½ë¡œ
- CCTV ë§ì€ ê²½ë¡œ ìš°ì„  í‘œì‹œ
- ì˜ˆìƒ ì†Œìš” ì‹œê°„
- CCTV ê°œìˆ˜ í‘œì‹œ

âœ… **CCTV ë§µ ê³µìœ **
- íŠ¹ì • ì§€ì—­ CCTV ë§µ ìŠ¤í¬ë¦°ìƒ· ê³µìœ 
- ì¹´ì¹´ì˜¤í†¡, ë©”ì‹œì§€ ê³µìœ 

### Out of Scope
âŒ CCTV ì‹¤ì‹œê°„ ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë° - Phase 3
âŒ CCTV ê³ ì¥ ì‹ ê³  - Phase 2
âŒ ì‚¬ìš©ì ì œë³´ CCTV - Phase 2
âŒ ì•ˆì „ ì ìˆ˜ (AI ê¸°ë°˜) - Phase 3

## User Stories

### Story 3.1: CCTV ì§€ë„ ê¸°ë³¸ í™”ë©´
**As a** ì‚¬ìš©ì
**I want to** ë‚´ ì£¼ë³€ CCTVë¥¼ ì§€ë„ì—ì„œ ë³´ê³ 
**So that** ì–´ë””ì— CCTVê°€ ìˆëŠ”ì§€ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] í˜„ì¬ ìœ„ì¹˜ ì¤‘ì‹¬ ì§€ë„ (GPS)
- [ ] ë°˜ê²½ 1km ë‚´ CCTV ë§ˆì»¤ í‘œì‹œ
- [ ] CCTV ë§ˆì»¤ ì•„ì´ì½˜ (ì¹´ë©”ë¼ ëª¨ì–‘)
- [ ] ë‚´ ìœ„ì¹˜ ë§ˆì»¤ (íŒŒë€ìƒ‰ ì )
- [ ] ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ë²„íŠ¼
- [ ] ìƒë‹¨: "CCTV ì•ˆì „ë§µ" íƒ€ì´í‹€
- [ ] í•˜ë‹¨: CCTV ê°œìˆ˜ í‘œì‹œ (ì˜ˆ: "ì£¼ë³€ CCTV 125ê°œ")

**Tasks:**
- [ ] CctvMapScreen ìœ„ì ¯ ì‘ì„±
- [ ] flutter_naver_map ë˜ëŠ” google_maps_flutter í†µí•©
- [ ] GET /api/public-data/cctv?lat=...&lng=...&radius=1000
- [ ] ì§€ë„ ë§ˆì»¤ ë Œë”ë§
- [ ] GPS ê¶Œí•œ ìš”ì²­

**Story Points:** 5

---

### Story 3.2: CCTV ë§ˆì»¤ í´ëŸ¬ìŠ¤í„°ë§
**As a** ì‚¬ìš©ì
**I want to** ë§ì€ CCTV ë§ˆì»¤ê°€ ê²¹ì¹˜ì§€ ì•Šê³ 
**So that** ì§€ë„ë¥¼ ê¹”ë”í•˜ê²Œ ë³¼ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì¤Œ ì•„ì›ƒ ì‹œ CCTV ë§ˆì»¤ ê·¸ë£¹í™” (ìˆ«ì í‘œì‹œ)
- [ ] í´ëŸ¬ìŠ¤í„° í´ë¦­ ì‹œ í•´ë‹¹ ì˜ì—­ í™•ëŒ€
- [ ] ì¤Œ ì¸ ì‹œ ê°œë³„ CCTV ë§ˆì»¤ í‘œì‹œ
- [ ] í´ëŸ¬ìŠ¤í„° ìƒ‰ìƒ: CCTV ë°€ë„ì— ë”°ë¼ (ë…¹ìƒ‰ â†’ ë…¸ë€ìƒ‰ â†’ ë¹¨ê°„ìƒ‰)

**Tasks:**
- [ ] Marker Clustering ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- [ ] í´ëŸ¬ìŠ¤í„° ì•„ì´ì½˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•
- [ ] ì¤Œ ë ˆë²¨ì— ë”°ë¥¸ í´ëŸ¬ìŠ¤í„°ë§ ë¡œì§

**Story Points:** 5

---

### Story 3.3: CCTV ìƒì„¸ ì •ë³´ BottomSheet
**As a** ì‚¬ìš©ì
**I want to** CCTV ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ ë³´ê³ 
**So that** í•´ë‹¹ CCTVì˜ ëª©ì ê³¼ ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë§ˆì»¤ í´ë¦­ ì‹œ BottomSheet í‘œì‹œ
- [ ] CCTV ì •ë³´:
  - ìœ„ì¹˜ëª… (ì˜ˆ: "ì¢…ë¡œêµ¬ì²­ ì• êµì°¨ë¡œ")
  - ì„¤ì¹˜ ê¸°ê´€ (ì˜ˆ: "ì¢…ë¡œêµ¬ì²­")
  - ì„¤ì¹˜ ëª©ì  (ì˜ˆ: "ë°©ë²”")
  - ì£¼ì†Œ
  - í˜„ì¬ ìœ„ì¹˜ë¡œë¶€í„° ê±°ë¦¬ (ì˜ˆ: "125m")
- [ ] "ê¸¸ì°¾ê¸°" ë²„íŠ¼
- [ ] "ê³µìœ " ë²„íŠ¼

**Tasks:**
- [ ] CctvDetailBottomSheet ìœ„ì ¯ ì‘ì„±
- [ ] ê±°ë¦¬ ê³„ì‚° ë¡œì§ (Haversine formula)
- [ ] BottomSheet UI ë””ìì¸

**Story Points:** 3

---

### Story 3.4: ì£¼ì†Œ ê²€ìƒ‰
**As a** ì‚¬ìš©ì
**I want to** íŠ¹ì • ì£¼ì†Œì˜ CCTVë¥¼ ê²€ìƒ‰í•˜ê³ 
**So that** ë‚´ê°€ ê°€ê³  ì‹¶ì€ ê³³ì˜ CCTVë¥¼ ë¯¸ë¦¬ í™•ì¸í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ìƒë‹¨ ê²€ìƒ‰ ë°”
- [ ] ì£¼ì†Œ ì…ë ¥ ì‹œ ìë™ì™„ì„± (Kakao Address Search)
- [ ] ì£¼ì†Œ ì„ íƒ ì‹œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì§€ë„ ì´ë™
- [ ] í•´ë‹¹ ìœ„ì¹˜ ë°˜ê²½ 1km CCTV í‘œì‹œ

**Tasks:**
- [ ] ê²€ìƒ‰ ë°” UI
- [ ] Kakao Local API ì—°ë™ (ì£¼ì†Œ ê²€ìƒ‰)
- [ ] ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ UI
- [ ] ì§€ë„ ì¹´ë©”ë¼ ì´ë™ ì• ë‹ˆë©”ì´ì…˜

**Story Points:** 5

---

### Story 3.5: ë°˜ê²½ í•„í„° (500m, 1km, 2km)
**As a** ì‚¬ìš©ì
**I want to** ê²€ìƒ‰ ë°˜ê²½ì„ ì¡°ì ˆí•˜ê³ 
**So that** ì›í•˜ëŠ” ë²”ìœ„ì˜ CCTVë§Œ ë³¼ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ë°˜ê²½ ì„ íƒ ë²„íŠ¼ (500m, 1km, 2km)
- [ ] ì„ íƒëœ ë°˜ê²½ í‘œì‹œ (ì§€ë„ ìœ„ ì›)
- [ ] ë°˜ê²½ ë³€ê²½ ì‹œ CCTV ì¬ì¡°íšŒ
- [ ] í•˜ë‹¨ CCTV ê°œìˆ˜ ì—…ë°ì´íŠ¸

**Tasks:**
- [ ] ë°˜ê²½ ì„ íƒ ë²„íŠ¼ UI
- [ ] ì§€ë„ ìœ„ ì›(Circle) ì˜¤ë²„ë ˆì´
- [ ] API í˜¸ì¶œ (radius íŒŒë¼ë¯¸í„°)

**Story Points:** 3

---

### Story 3.6: ì„¤ì¹˜ ê¸°ê´€ë³„ í•„í„°
**As a** ì‚¬ìš©ì
**I want to** ì„¤ì¹˜ ê¸°ê´€ë³„ë¡œ CCTVë¥¼ í•„í„°ë§í•˜ê³ 
**So that** íŠ¹ì • ê¸°ê´€ì˜ CCTVë§Œ ë³¼ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] í•„í„° ë²„íŠ¼ (ìƒë‹¨ ìš°ì¸¡)
- [ ] í•„í„° ì˜µì…˜: ì „ì²´, ì„œìš¸ì‹œ, ì¢…ë¡œêµ¬ì²­, ê²½ì°°ì„œ ë“±
- [ ] ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥
- [ ] í•„í„° ì ìš© ì‹œ ì§€ë„ ì—…ë°ì´íŠ¸

**Tasks:**
- [ ] í•„í„° BottomSheet UI
- [ ] ì²´í¬ë°•ìŠ¤ ë‹¤ì¤‘ ì„ íƒ
- [ ] í•„í„°ë§ëœ CCTV ë§ˆì»¤ë§Œ í‘œì‹œ

**Story Points:** 3

---

### Story 3.7: ì•ˆì „ ê²½ë¡œ ì°¾ê¸°
**As a** ì‚¬ìš©ì
**I want to** CCTVê°€ ë§ì€ ì•ˆì „í•œ ê²½ë¡œë¥¼ ì°¾ê³ 
**So that** ì•¼ê°„ ê·€ê°€ ì‹œ ì•ˆì „í•˜ê²Œ ì´ë™í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] BottomSheetì—ì„œ "ê¸¸ì°¾ê¸°" ë²„íŠ¼ í´ë¦­
- [ ] ì¶œë°œì§€ (í˜„ì¬ ìœ„ì¹˜), ë„ì°©ì§€ (ì„ íƒí•œ CCTV) ì„¤ì •
- [ ] ê²½ë¡œ í‘œì‹œ (Polyline)
- [ ] ê²½ë¡œ ìƒì˜ CCTV ê°œìˆ˜ í‘œì‹œ
- [ ] ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ë„ë³´ ê¸°ì¤€)
- [ ] ëŒ€ì•ˆ ê²½ë¡œ (CCTV ì ì€ ê²½ë¡œ ë¹„êµ)

**Tasks:**
- [ ] ê²½ë¡œ ì°¾ê¸° API ì—°ë™ (Kakao Navigation or Naver Directions)
- [ ] Polyline ê·¸ë¦¬ê¸°
- [ ] ê²½ë¡œ ìƒ CCTV ê°œìˆ˜ ê³„ì‚° (ST_Buffer)
- [ ] ëŒ€ì•ˆ ê²½ë¡œ UI

**Story Points:** 8

---

### Story 3.8: CCTV ë°€ë„ íˆíŠ¸ë§µ (ì„ íƒ ì‚¬í•­)
**As a** ì‚¬ìš©ì
**I want to** CCTV ë°€ë„ë¥¼ íˆíŠ¸ë§µìœ¼ë¡œ ë³´ê³ 
**So that** ì–´ë–¤ ì§€ì—­ì´ ì•ˆì „í•œì§€ ì‹œê°ì ìœ¼ë¡œ íŒŒì•…í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] íˆíŠ¸ë§µ ë ˆì´ì–´ ON/OFF í† ê¸€
- [ ] CCTV ë°€ë„ì— ë”°ë¼ ìƒ‰ìƒ ë³€í™” (íŒŒë€ìƒ‰ â†’ ë¹¨ê°„ìƒ‰)
- [ ] ë°˜íˆ¬ëª… ì˜¤ë²„ë ˆì´
- [ ] ì§€ë„ í™•ëŒ€/ì¶•ì†Œì— ë”°ë¼ íˆíŠ¸ë§µ ì—…ë°ì´íŠ¸

**Tasks:**
- [ ] íˆíŠ¸ë§µ ë¼ì´ë¸ŒëŸ¬ë¦¬ (google_maps_flutter heatmap)
- [ ] CCTV ì¢Œí‘œ ë°°ì—´ ì „ë‹¬
- [ ] íˆíŠ¸ë§µ ë ˆì´ì–´ í† ê¸€ ë²„íŠ¼

**Story Points:** 5

---

### Story 3.9: CCTV ë§µ ê³µìœ 
**As a** ì‚¬ìš©ì
**I want to** CCTV ë§µì„ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê³ 
**So that** ìš°ë¦¬ ë™ë„¤ CCTV ì •ë³´ë¥¼ ì•Œë ¤ì¤„ ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] "ê³µìœ " ë²„íŠ¼ (ìƒë‹¨ ìš°ì¸¡)
- [ ] í˜„ì¬ ì§€ë„ í™”ë©´ ìº¡ì²˜
- [ ] ê³µìœ  ì˜µì…˜: ì¹´ì¹´ì˜¤í†¡, ë©”ì‹œì§€, URL ë³µì‚¬
- [ ] ê³µìœ  ë©”ì‹œì§€: "ìš°ë¦¬ ë™ë„¤ CCTV ì•ˆì „ë§µ - íƒ€ìš´ì¸"

**Tasks:**
- [ ] Screenshot ìº¡ì²˜ (RepaintBoundary)
- [ ] share_plus íŒ¨í‚¤ì§€ ì‚¬ìš©
- [ ] ê³µìœ  ë©”ì‹œì§€ í…œí”Œë¦¿

**Story Points:** 3

---

### Story 3.10: CCTV ë§µ ì¦ê²¨ì°¾ê¸° (ì„ íƒ ì‚¬í•­)
**As a** ì‚¬ìš©ì
**I want to** ìì£¼ ë³´ëŠ” ìœ„ì¹˜ë¥¼ ì¦ê²¨ì°¾ê¸°í•˜ê³ 
**So that** ë¹ ë¥´ê²Œ í•´ë‹¹ ìœ„ì¹˜ì˜ CCTVë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤

**Acceptance Criteria:**
- [ ] ì¦ê²¨ì°¾ê¸° ì¶”ê°€ ë²„íŠ¼
- [ ] ì¦ê²¨ì°¾ê¸° ëª©ë¡ (BottomSheet)
- [ ] ì¦ê²¨ì°¾ê¸° ì„ íƒ ì‹œ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
- [ ] ìµœëŒ€ 5ê°œ ì¦ê²¨ì°¾ê¸°

**Tasks:**
- [ ] FavoriteCctvLocation ë¡œì»¬ ì €ì¥ (SharedPreferences)
- [ ] ì¦ê²¨ì°¾ê¸° ëª©ë¡ UI
- [ ] ì¦ê²¨ì°¾ê¸° CRUD

**Story Points:** 3

## Technical Specifications

### Technology Stack
- **Framework**: Flutter 3.x
- **Maps**: flutter_naver_map (ë„¤ì´ë²„ ì§€ë„) ë˜ëŠ” google_maps_flutter
- **Clustering**: google_maps_cluster_manager ë˜ëŠ” ì»¤ìŠ¤í…€ êµ¬í˜„
- **Routing**: Kakao Mobility API (ê²½ë¡œ ì°¾ê¸°)
- **Share**: share_plus
- **Screenshot**: RepaintBoundary + dart:ui

### Architecture Decisions

#### 1. ì§€ë„ SDK ì„ íƒ
**Decision**: ë„¤ì´ë²„ ì§€ë„ (flutter_naver_map)

**Rationale**:
- **í•œêµ­ ì§€ë„**: êµ­ë‚´ ìµœì í™”, ìƒì„¸í•œ í•œêµ­ ì§€ë„
- **ë¬´ë£Œ í• ë‹¹ëŸ‰**: ì¼ 300,000ê±´ (Google Mapsë³´ë‹¤ ë†’ìŒ)
- **CCTV ë°ì´í„°**: ì„œìš¸ì‹œ ë°ì´í„°ì™€ í˜¸í™˜ì„± ì¢‹ìŒ

**Fallback**: Google Maps (í•´ì™¸ í™•ì¥ ì‹œ)

#### 2. Marker Clustering
**Decision**: ì»¤ìŠ¤í…€ í´ëŸ¬ìŠ¤í„°ë§ êµ¬í˜„

**Rationale**:
- **ì„±ëŠ¥**: 1,000ê°œ ì´ìƒ ë§ˆì»¤ë„ ë¶€ë“œëŸ¬ìš´ ë Œë”ë§
- **ì»¤ìŠ¤í„°ë§ˆì´ì§•**: í´ëŸ¬ìŠ¤í„° ìƒ‰ìƒ, í¬ê¸° ììœ ë¡­ê²Œ ì¡°ì •
- **ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œí•œ**: ê¸°ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Naver Map ë¯¸ì§€ì›

**êµ¬í˜„**:
```dart
// H3 Grid Cell ê¸°ë°˜ í´ëŸ¬ìŠ¤í„°ë§
class CctvClusterManager {
  Map<String, List<Cctv>> clusterCctvs(List<Cctv> cctvs, int resolution) {
    final clusters = <String, List<Cctv>>{};

    for (final cctv in cctvs) {
      final h3Index = latLngToCell(cctv.lat, cctv.lng, resolution);
      clusters.putIfAbsent(h3Index, () => []).add(cctv);
    }

    return clusters;
  }
}
```

#### 3. ê²½ë¡œ ì°¾ê¸° API
**Decision**: Kakao Mobility API

**Rationale**:
- **ë„ë³´ ê²½ë¡œ**: Naverë³´ë‹¤ ì •í™•í•œ ë„ë³´ ê²½ë¡œ
- **ë¬´ë£Œ**: ì¼ 300,000ê±´
- **CCTV í†µê³¼ ê²½ë¡œ**: Waypoint ì§€ì›

### API Endpoints Used

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/public-data/cctv?lat=37.5665&lng=126.9780&radius=1000` | CCTV ì¡°íšŒ (ë°˜ê²½) |
| GET | `/api/public-data/cctv?regionId=...` | CCTV ì¡°íšŒ (ì§€ì—­ë³„) |
| GET | `/api/public-data/map?types=cctv&bounds=...` | CCTV GeoJSON |

### External APIs

| Provider | API | Usage |
|----------|-----|-------|
| Kakao | Local API (ì£¼ì†Œ ê²€ìƒ‰) | ì£¼ì†Œ ìë™ì™„ì„± |
| Kakao | Mobility API (ê²½ë¡œ) | ì•ˆì „ ê²½ë¡œ ì°¾ê¸° |

### State Management (Riverpod)
```dart
// cctv_map_provider.dart
final cctvMapProvider = StateNotifierProvider<CctvMapNotifier, CctvMapState>((ref) {
  return CctvMapNotifier(ref.read(apiServiceProvider));
});

class CctvMapState {
  final List<Cctv> cctvs;
  final LatLng? currentLocation;
  final double radius; // 500, 1000, 2000
  final List<String> selectedAgencies; // í•„í„°
  final bool isLoading;

  CctvMapState({
    this.cctvs = const [],
    this.currentLocation,
    this.radius = 1000,
    this.selectedAgencies = const [],
    this.isLoading = false,
  });
}

class CctvMapNotifier extends StateNotifier<CctvMapState> {
  CctvMapNotifier(this._apiService) : super(CctvMapState());

  final ApiService _apiService;

  Future<void> loadCctvs(LatLng location, double radius) async {
    state = state.copyWith(isLoading: true);

    try {
      final cctvs = await _apiService.getCctvs(
        lat: location.latitude,
        lng: location.longitude,
        radius: radius,
      );

      state = state.copyWith(
        cctvs: cctvs,
        currentLocation: location,
        radius: radius,
        isLoading: false,
      );
    } catch (e) {
      state = state.copyWith(isLoading: false);
      rethrow;
    }
  }

  void setRadius(double radius) {
    state = state.copyWith(radius: radius);
    loadCctvs(state.currentLocation!, radius);
  }

  void setAgencyFilter(List<String> agencies) {
    state = state.copyWith(selectedAgencies: agencies);
  }

  List<Cctv> get filteredCctvs {
    if (state.selectedAgencies.isEmpty) return state.cctvs;
    return state.cctvs.where((cctv) =>
      state.selectedAgencies.contains(cctv.installationAgency)
    ).toList();
  }
}
```

### Screen Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† CCTV ì•ˆì „ë§µ       ğŸ” ê³µìœ   â”‚ â† AppBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì£¼ì†Œ ê²€ìƒ‰]                â”‚ â† ê²€ìƒ‰ ë°”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚      ğŸ—ºï¸ ì§€ë„ ì˜ì—­            â”‚
â”‚   ğŸ“¹ CCTV ë§ˆì»¤ë“¤             â”‚
â”‚   ğŸ“ í˜„ì¬ ìœ„ì¹˜              â”‚
â”‚                             â”‚
â”‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [500m] [1km] [2km]  [í•„í„°]  â”‚ â† ë°˜ê²½/í•„í„° ë²„íŠ¼
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì£¼ë³€ CCTV 125ê°œ             â”‚ â† ê°œìˆ˜ í‘œì‹œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[CCTV í´ë¦­ ì‹œ BottomSheet]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì¢…ë¡œêµ¬ì²­ ì• êµì°¨ë¡œ            â”‚
â”‚ ì¢…ë¡œêµ¬ì²­ Â· ë°©ë²”              â”‚
â”‚ ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì„¸ì¢…ëŒ€ë¡œ... â”‚
â”‚ í˜„ì¬ ìœ„ì¹˜ë¡œë¶€í„° 125m         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ê¸¸ì°¾ê¸°]           [ê³µìœ ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Testing Strategy

### Unit Tests
- [ ] CctvMapNotifier ìƒíƒœ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
- [ ] ê±°ë¦¬ ê³„ì‚° ë¡œì§ í…ŒìŠ¤íŠ¸ (Haversine)
- [ ] í•„í„°ë§ ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] í´ëŸ¬ìŠ¤í„°ë§ ë¡œì§ í…ŒìŠ¤íŠ¸

### Widget Tests
- [ ] CctvMapScreen ì§€ë„ ë Œë”ë§ í…ŒìŠ¤íŠ¸
- [ ] CctvDetailBottomSheet UI í…ŒìŠ¤íŠ¸
- [ ] ë°˜ê²½ í•„í„° ë²„íŠ¼ í…ŒìŠ¤íŠ¸

### Integration Tests
- [ ] CCTV ì¡°íšŒ â†’ ì§€ë„ í‘œì‹œ í”Œë¡œìš°
- [ ] ì£¼ì†Œ ê²€ìƒ‰ â†’ ì§€ë„ ì´ë™ í”Œë¡œìš°
- [ ] ê²½ë¡œ ì°¾ê¸° í”Œë¡œìš°

### Performance Tests
- [ ] 1,000ê°œ CCTV ë§ˆì»¤ ë Œë”ë§ ì„±ëŠ¥
- [ ] ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ë¶€ë“œëŸ¬ì›€
- [ ] API ì‘ë‹µ ì‹œê°„ < 2ì´ˆ

## Deployment Checklist

### Pre-Deployment
- [ ] ë„¤ì´ë²„ ì§€ë„ API í‚¤ ë°œê¸‰
- [ ] Kakao Local/Mobility API í‚¤ ë°œê¸‰
- [ ] CCTV ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ (ì„œìš¸ 25ê°œ êµ¬)

### Deployment
- [ ] Android/iOS ë¹Œë“œ
- [ ] ì§€ë„ API í‚¤ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] CCTV ë§µ ì‚¬ìš©ë¥  ì¶”ì  (Analytics)

### Post-Deployment
- [ ] CCTV ë§µ ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§
- [ ] ì•ˆì „ ê²½ë¡œ ì°¾ê¸° ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§
- [ ] ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘

## Risks & Mitigation

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| ì§€ë„ API í• ë‹¹ëŸ‰ ì´ˆê³¼ | High | Low | ìºì‹±, ë„¤ì´ë²„ â†’ Google Fallback |
| ë§ì€ ë§ˆì»¤ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ | Medium | Medium | í´ëŸ¬ìŠ¤í„°ë§, ë·°í¬íŠ¸ ë‚´ ë§ˆì»¤ë§Œ ë Œë”ë§ |
| GPS ê¶Œí•œ ê±°ë¶€ | Medium | High | ì£¼ì†Œ ê²€ìƒ‰ ëŒ€ì²´ ë°©ë²• |
| CCTV ë°ì´í„° ë¶€ì •í™• | Medium | Low | ê³µê³µ ë°ì´í„° ì •ê¸° ì—…ë°ì´íŠ¸ |
| ê²½ë¡œ ì°¾ê¸° API ì¥ì•  | Low | Low | ì—ëŸ¬ ë©”ì‹œì§€, ì¬ì‹œë„ ë²„íŠ¼ |

## Dependencies

### Depends On (Prerequisites)
- **CORE-002**: Geospatial Data Infrastructure (GPS, ì§€ë„)
- **CORE-003**: Public Data Integration (CCTV ë°ì´í„°)

### Blocks (Dependent Epics)
- **USR-006**: Integrated Safety Map (CCTV + ì£¼ì°¨ì¥ + ëŒ€í”¼ì†Œ í†µí•©)

## Related Epics

- **USR-004**: Safety Map (Parking) (ì£¼ì°¨ì¥ ë§µ)
- **USR-005**: Safety Map (Disaster) (ì¬ë‚œ ëŒ€í”¼ì†Œ ë§µ)
- **USR-006**: Integrated Safety Map (í†µí•© ì•ˆì „ë§µ)

## Future Enhancements

### Phase 2
- ì‚¬ìš©ì ì œë³´ CCTV (í¬ë¼ìš°ë“œì†Œì‹±)
- CCTV ê³ ì¥ ì‹ ê³ 
- ì•ˆì „ ê²½ë¡œ ì¦ê²¨ì°¾ê¸°

### Phase 3
- CCTV ì‹¤ì‹œê°„ ì˜ìƒ ìŠ¤íŠ¸ë¦¬ë° (ë¼ì´ë¸Œë·°)
- AI ê¸°ë°˜ ì•ˆì „ ì ìˆ˜ (CCTV ë°€ë„ + ì¡°ëª… + ë²”ì£„ìœ¨)
- ì‹œê°„ëŒ€ë³„ ì•ˆì „ë„ (ì•¼ê°„ vs ì£¼ê°„)

### Phase 4
- ê¸€ë¡œë²Œ CCTV ë§µ (Vietnam, Japan)
- AR ê¸°ë°˜ CCTV ìœ„ì¹˜ í‘œì‹œ (ì¹´ë©”ë¼ ì˜¤ë²„ë ˆì´)

## Notes

### ì•ˆì „ ê²½ë¡œ ì ìˆ˜ ê³„ì‚° (Phase 3)
```dart
double calculateSafetyScore(Route route) {
  final cctvCount = countCctvOnRoute(route);
  final lightingScore = analyzeLighting(route); // ê°€ë¡œë“± ë°ì´í„°
  final crimeRate = getCrimeRate(route.region); // ë²”ì£„ í†µê³„

  return (cctvCount * 0.5) + (lightingScore * 0.3) + ((1 - crimeRate) * 0.2);
}
```

### Flutter Packages
```yaml
dependencies:
  flutter_naver_map: ^1.0.0 # ë˜ëŠ” google_maps_flutter
  geolocator: ^10.0.0
  share_plus: ^7.0.0
  dio: ^5.3.0
  cached_network_image: ^3.3.0
  h3_dart: ^0.3.0 # H3 Clustering
```

### References
- ë„¤ì´ë²„ ì§€ë„ SDK: https://navermaps.github.io/flutter-map-sdk/
- Kakao Mobility API: https://developers.kakao.com/docs/latest/ko/local/dev-guide
- Google Maps Flutter: https://pub.dev/packages/google_maps_flutter
- H3 Geo: https://h3geo.org/
